# Offline-First Architecture - Visual Diagrams

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SALES POS SYSTEM                           â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    CLIENT (BROWSER)                        â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚  â”‚  React UI       â”‚  â”‚  Context State   â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  Components     â”‚  â”‚  (CartContext,   â”‚               â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚   StaffContext)  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ MenuScreen    â”‚  â”‚                  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ TopBar        â”‚  â”‚ â€¢ activeCart     â”‚               â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Sidebar       â”‚  â”‚ â€¢ orders         â”‚               â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ POSSystem     â”‚  â”‚ â€¢ isOnline       â”‚               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚           â”‚                    â”‚                         â”‚   â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚  â”‚                    â†“                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚       IndexedDB (Local Storage)                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  (src/lib/indexedDB.js)                         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Store: PRODUCTS                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ _id, name, category, price                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ Index: category                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Store: CATEGORIES                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ _id, name                                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Store: TRANSACTIONS                           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ id (auto-increment)                        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ items, total, synced, createdAt            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ Indexes: synced, createdAt                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Store: SYNC_META                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ lastSyncTime: timestamp                    â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚             â”‚                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚             â”‚         SERVICE LAYER                     â”‚   â”‚
â”‚  â”‚             â†“                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  syncService.js      â”‚  â”‚  Sync Status         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                      â”‚  â”‚  â€¢ online/offline    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ setupAutoSync()    â”‚  â”‚  â€¢ syncing progress  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ autoSync Txns()    â”‚  â”‚  â€¢ pending count     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ monitors events    â”‚  â”‚  â€¢ last sync time    â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚             â”‚                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ (HTTP/HTTPS)
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVER (NODE.JS)                           â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        API Endpoints (src/pages/api/)               â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  GET  /api/categories                               â”‚   â”‚
â”‚  â”‚  â”‚â””â”€ Query MongoDB, cache in IndexedDB              â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  GET  /api/products?category=Drinks                 â”‚   â”‚
â”‚  â”‚  â”‚â””â”€ Query MongoDB, cache in IndexedDB              â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  POST /api/transactions/sync âœ¨ NEW                â”‚   â”‚
â”‚  â”‚  â”‚â””â”€ Receive offline transaction from client        â”‚   â”‚
â”‚  â”‚  â””â”€ Validate & save to MongoDB                      â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                   â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     Mongoose Models (src/models/)                    â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  â€¢ Product                                           â”‚   â”‚
â”‚  â”‚  â€¢ Category                                          â”‚   â”‚
â”‚  â”‚  â€¢ Transaction (updated)                            â”‚   â”‚
â”‚  â”‚    â”œâ”€ externalId (client ID)                        â”‚   â”‚
â”‚  â”‚    â”œâ”€ syncedFrom: "offline"                         â”‚   â”‚
â”‚  â”‚    â””â”€ syncedAt: timestamp                           â”‚   â”‚
â”‚  â”‚  â€¢ Staff                                             â”‚   â”‚
â”‚  â”‚  â€¢ Store                                             â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                   â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          MongoDB (Database)                          â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  â€¢ Products Collection                               â”‚   â”‚
â”‚  â”‚  â€¢ Categories Collection                             â”‚   â”‚
â”‚  â”‚  â€¢ Transactions Collection                           â”‚   â”‚
â”‚  â”‚  â€¢ Staff Collection                                  â”‚   â”‚
â”‚  â”‚  â€¢ Store Collection                                  â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram - Normal Operation (Online)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NORMAL OPERATION                          â”‚
â”‚                    (INTERNET ONLINE)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. LOAD PRODUCTS

   User selects category
         â†“
   [MenuScreen] checks IndexedDB
         â†“
   Is cache empty? 
         â”œâ”€ YES â†’ Fetch from /api/products
         â”‚         â””â”€ Store in IndexedDB
         â”‚         â””â”€ Display products
         â”‚
         â””â”€ NO â†’ Load from IndexedDB
                 â””â”€ Display products (instant)


2. CREATE SALE

   Staff adds items to cart
         â†“
   [CartContext.addItem()] adds to activeCart
         â†“
   Staff completes order
         â†“
   [CartContext.completeOrder()]
         â”œâ”€ Create transaction object
         â”œâ”€ Save to IndexedDB
         â”œâ”€ Get pending count
         â””â”€ Trigger autoSyncTransactions()
                â†“
         [syncService.autoSyncTransactions()]
         â”œâ”€ Call /api/transactions/sync
         â”œâ”€ Server saves to MongoDB
         â”œâ”€ Mark as synced in IndexedDB
         â””â”€ Update UI (pending badge clears)


3. RESULT

   âœ… Transaction in cloud database
   âœ… TopBar shows ğŸŸ¢ Online
   âœ… No pending badge
   âœ… Staff continues working
```

---

## Data Flow Diagram - Offline Operation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OFFLINE OPERATION                         â”‚
â”‚              (INTERNET DISCONNECTED)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STAGE 1: INTERNET DROPS (Auto-Detected)

   setupAutoSync() listens for "offline" event
         â†“
   TopBar changes to ğŸ”´ Offline
   Red banner appears
   "OFFLINE MODE" message shown


STAGE 2: STAFF WORKS OFFLINE

   Staff browses products (from IndexedDB cache)
         â†“
   Staff creates sale
         â†“
   [CartContext.completeOrder()]
         â”œâ”€ Create transaction
         â”œâ”€ [addLocalTransaction()] â†’ IndexedDB
         â”‚  â””â”€ Set synced: false
         â”œâ”€ Increment pendingSyncCount
         â””â”€ Skip auto-sync (offline)
                â†“
   TopBar updates with "1 pending" badge
   Sidebar shows pending count
   Multiple sales accumulate in queue


STAGE 3: STAFF CREATES MORE SALES

   Repeat STAGE 2
   Pending count increases: "2 pending" â†’ "3 pending"
   All transactions saved locally
   Zero data loss


STAGE 4: INTERNET RETURNS

   setupAutoSync() detects "online" event
         â†“
   Wait 1 second for stability
         â†“
   Trigger [autoSyncTransactions()]
         â”œâ”€ [getUnsyncedTransactions()] from IndexedDB
         â”œâ”€ For each unsynced transaction:
         â”‚  â”œâ”€ POST to /api/transactions/sync
         â”‚  â””â”€ Server saves to MongoDB
         â”œâ”€ [markTransactionSynced(id)] in IndexedDB
         â””â”€ When all complete:
                â””â”€ Update UI
                â”œâ”€ Clear pending badge
                â”œâ”€ TopBar â†’ ğŸŸ¢ Online
                â””â”€ Sidebar â†’ "Last sync: just now"


RESULT

   âœ… All offline transactions now in cloud
   âœ… Zero data loss
   âœ… Automatic (no user action)
   âœ… Staff unaware of offline operation
```

---

## Component Integration Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    POSLayout (Main)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚ â”‚  TopBar (Enhanced)                             â”‚   â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ useCart() â†’ pendingSyncCount, isOnline    â”‚   â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ Shows ğŸŸ¢/ğŸ”´ WiFi indicator               â”‚   â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ Shows pending count badge                â”‚   â”‚ â”‚
â”‚  â”‚ â”‚  â””â”€ Red banner when offline                  â”‚   â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚  POSSystem (Content Area)                       â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ MenuScreen (Tab)                           â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”‚  â”œâ”€ useCart() â†’ addItem()                  â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”‚  â”œâ”€ IndexedDB â†’ getLocalProducts()        â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”‚  â”œâ”€ Sync button â†’ handleManualSync()      â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”‚  â””â”€ Last sync timestamp                   â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”‚                                             â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ CustomerScreen (Tab)                      â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ OrdersScreen (Tab)                        â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â””â”€ ReportsScreen (Tab)                       â”‚ â”‚ â”‚
â”‚  â”‚ â”‚                                                â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚  â”‚ Cart Display                            â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”‚ â”œâ”€ useCart() â†’ activeCart               â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”‚ â”œâ”€ calculateTotals()                    â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”‚ â”œâ”€ completeOrder() - saves to IndexedDBâ”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”‚ â””â”€ Payment Modal integration            â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚  Sidebar (Enhanced)                             â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ useCart() â†’ manualSync, pendingSyncCount  â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ Online/Offline status display             â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â”œâ”€ "Sync Transactions" button                â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  â””â”€ handleManualSync() â†’ syncService          â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚        CartContext (State Mgmt)        â”‚
         â”‚                                        â”‚
         â”‚ Import:                                â”‚
         â”‚ â€¢ indexedDB functions                 â”‚
         â”‚ â€¢ syncService.autoSync                â”‚
         â”‚                                        â”‚
         â”‚ On completeOrder():                   â”‚
         â”‚ 1. Create transaction object          â”‚
         â”‚ 2. addLocalTransaction() â†’ IndexedDB  â”‚
         â”‚ 3. Increment pendingSyncCount         â”‚
         â”‚ 4. Trigger autoSyncTransactions()     â”‚
         â”‚                                        â”‚
         â”‚ Export:                                â”‚
         â”‚ â€¢ pendingSyncCount                    â”‚
         â”‚ â€¢ manualSync function                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      IndexedDB Service                  â”‚
         â”‚  (src/lib/indexedDB.js)                 â”‚
         â”‚                                         â”‚
         â”‚ Functions:                              â”‚
         â”‚ â€¢ initIndexedDB()                       â”‚
         â”‚ â€¢ getLocalCategories()                  â”‚
         â”‚ â€¢ getLocalProductsByCategory()          â”‚
         â”‚ â€¢ addLocalTransaction()                 â”‚
         â”‚ â€¢ getUnsyncedTransactions()             â”‚
         â”‚ â€¢ markTransactionSynced()               â”‚
         â”‚ â€¢ syncProducts()                        â”‚
         â”‚ â€¢ syncCategories()                      â”‚
         â”‚ â€¢ getSyncMeta()                         â”‚
         â”‚ â€¢ clearAllData()                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      Sync Service                       â”‚
         â”‚  (src/services/syncService.js)          â”‚
         â”‚                                         â”‚
         â”‚ On "online" event detected:             â”‚
         â”‚ 1. Wait 1 second                        â”‚
         â”‚ 2. autoSyncTransactions()               â”‚
         â”‚    â”œâ”€ Get unsynced from IndexedDB       â”‚
         â”‚    â”œâ”€ POST each to /api/transactions    â”‚
         â”‚    â””â”€ Mark synced in IndexedDB          â”‚
         â”‚ 3. Update UI state                      â”‚
         â”‚                                         â”‚
         â”‚ Exports:                                â”‚
         â”‚ â€¢ setupAutoSync()                       â”‚
         â”‚ â€¢ autoSyncTransactions()                â”‚
         â”‚ â€¢ getSyncStatus()                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      API Layer                          â”‚
         â”‚  (src/pages/api/)                       â”‚
         â”‚                                         â”‚
         â”‚ GET /api/categories                     â”‚
         â”‚ GET /api/products?category=X            â”‚
         â”‚ POST /api/transactions/sync âœ¨ NEW    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      MongoDB Database                   â”‚
         â”‚  (Cloud/Server)                         â”‚
         â”‚                                         â”‚
         â”‚ Collections:                            â”‚
         â”‚ â€¢ Products                              â”‚
         â”‚ â€¢ Categories                            â”‚
         â”‚ â€¢ Transactions (receives synced data)   â”‚
         â”‚ â€¢ Staff                                 â”‚
         â”‚ â€¢ Store                                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Management Flow

```
USER ACTION
    â†“
    â”œâ”€â”€â”€ Browse Products
    â”‚    â”œâ”€ MenuScreen renders
    â”‚    â”œâ”€ Query IndexedDB for categories
    â”‚    â”‚  â””â”€ If empty, fetch from /api/categories
    â”‚    â”œâ”€ User selects category
    â”‚    â”œâ”€ Query IndexedDB for products
    â”‚    â”‚  â””â”€ If empty, fetch from /api/products
    â”‚    â””â”€ Display products (instant or network time)
    â”‚
    â”œâ”€â”€â”€ Add to Cart
    â”‚    â”œâ”€ User clicks product
    â”‚    â”œâ”€ CartContext.addItem(product)
    â”‚    â””â”€ activeCart.items.push() + recalculate totals
    â”‚
    â”œâ”€â”€â”€ Complete Sale
    â”‚    â”œâ”€ User clicks "Complete Order"
    â”‚    â”œâ”€ CartContext.completeOrder(paymentMethod)
    â”‚    â”œâ”€ Create transaction object
    â”‚    â”œâ”€ addLocalTransaction() â†’ IndexedDB
    â”‚    â”‚  â””â”€ synced: false
    â”‚    â”œâ”€ Increment pendingSyncCount
    â”‚    â”œâ”€ If online:
    â”‚    â”‚  â””â”€ autoSyncTransactions()
    â”‚    â”‚     â””â”€ POST /api/transactions/sync
    â”‚    â”‚        â””â”€ Mark synced in IndexedDB
    â”‚    â””â”€ Update UI (pending badge)
    â”‚
    â”œâ”€â”€â”€ Manual Sync
    â”‚    â”œâ”€ User clicks "Sync Products"/"Sync Transactions"
    â”‚    â”œâ”€ Fetch from API
    â”‚    â”œâ”€ Update IndexedDB
    â”‚    â””â”€ Update UI
    â”‚
    â””â”€â”€â”€ Connection Change
         â”œâ”€ setupAutoSync() listens
         â”œâ”€ Goes offline â†’ TopBar red, banner shown
         â”œâ”€ Goes online â†’ autoSyncTransactions()
         â”‚  â””â”€ GET unsynced from IndexedDB
         â”‚  â””â”€ POST each to /api/transactions/sync
         â”‚  â””â”€ Mark synced
         â””â”€ TopBar green, pending badge clear
```

---

## Sync State Machine

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ONLINE    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Auto-detect "offline"
                           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ OFFLINE_NOT_SYNCING â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ â€¢ Red WiFi icon     â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚               â”‚ â€¢ Show banner       â”‚              â”‚
    â”‚               â”‚ â€¢ Queue transactionsâ”‚              â”‚
    â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
    â”‚                          â”‚                        â”‚
    â”‚                          â”‚ Stay offline           â”‚
    â”‚                          â”‚ Save transactions      â”‚
    â”‚                          â”‚ (synced: false)        â”‚
    â”‚                          â”‚                        â”‚
    â”‚                          â†“                        â”‚
    â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
    â”‚               â”‚ PENDING_TO_SYNC      â”‚            â”‚
    â”‚               â”‚ â€¢ Multiple txns queued            â”‚
    â”‚               â”‚ â€¢ All marked synced: false        â”‚
    â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
    â”‚                          â”‚                        â”‚
    â”‚                          â”‚ Auto-detect "online"   â”‚
    â”‚                          â”‚ OR Manual sync clicked  â”‚
    â”‚                          â†“                        â”‚
    â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
    â”‚               â”‚ SYNCING              â”‚â”€â”€â”€â”€â”       â”‚
    â”‚               â”‚ â€¢ POST to /api       â”‚    â”‚       â”‚
    â”‚               â”‚ â€¢ Mark synced        â”‚    â”‚       â”‚
    â”‚               â”‚ â€¢ Show spinner       â”‚    â”‚       â”‚
    â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       â”‚
    â”‚                          â”‚                 â”‚       â”‚
    â”‚                       Success              â”‚       â”‚
    â”‚                          â”‚                 â”‚       â”‚
    â”‚                          â†“                 â”‚       â”‚
    â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚       â”‚
    â”‚               â”‚ SYNCED               â”‚    â”‚       â”‚
    â”‚               â”‚ â€¢ Green WiFi         â”‚    â”‚       â”‚
    â”‚               â”‚ â€¢ Pending badge clear    â”‚       â”‚
    â”‚               â”‚ â€¢ Update lastSyncTimeâ”‚    â”‚       â”‚
    â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       â”‚
    â”‚                          â”‚                 â”‚       â”‚
    â”‚                          â”‚                 â”‚       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             Error/Retry
                                               â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## UI State Indicators

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TOPBAR STATES                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  STATE: ONLINE                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸŸ¢ Online Status                                      â”‚ â”‚
â”‚  â”‚ No pending badge (or "0" if counting)                â”‚ â”‚
â”‚  â”‚ No offline banner                                    â”‚ â”‚
â”‚  â”‚ Normal blue TopBar                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  STATE: OFFLINE (No Pending)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ”´ Offline Indicator                                  â”‚ â”‚
â”‚  â”‚ Red offline banner: "OFFLINE MODE"                   â”‚ â”‚
â”‚  â”‚ No pending badge                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  STATE: OFFLINE (With Pending)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ”´ Offline Indicator              [3 pending]        â”‚ â”‚
â”‚  â”‚ Red offline banner: "OFFLINE MODE" [pending count]   â”‚ â”‚
â”‚  â”‚ Badge shows number of waiting transactions           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  STATE: SYNCING                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸŸ¢ Online Status                                      â”‚ â”‚
â”‚  â”‚ Spinner animation on pending badge                  â”‚ â”‚
â”‚  â”‚ "Syncing..." or similar message                      â”‚ â”‚
â”‚  â”‚ No banner (or fades out)                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  STATE: SYNCED                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸŸ¢ Online Status                                      â”‚ â”‚
â”‚  â”‚ No pending badge                                     â”‚ â”‚
â”‚  â”‚ "Last sync: 1 minute ago" in Sidebar                â”‚ â”‚
â”‚  â”‚ Normal operation resumed                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Transaction Lifecycle

```
CREATE
   â†“
   â”œâ”€ DRAFT (in cart, being edited)
   â”‚  â””â”€ In CartContext.activeCart
   â”‚
   â”œâ”€ COMPLETING (on complete button)
   â”‚  â””â”€ Create transaction object
   â”‚
   â””â”€ COMPLETE (transaction created)
      â””â”€ Save to IndexedDB with synced: false
         â””â”€ Increment pendingSyncCount
            â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ OFFLINE_AWAITING_SYNC                â”‚
   â”‚ â€¢ In IndexedDB TRANSACTIONS store    â”‚
   â”‚ â€¢ synced: false                      â”‚
   â”‚ â€¢ Ready for sync when online         â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ When online OR manual sync
          â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ SYNCING                              â”‚
   â”‚ â€¢ POST /api/transactions/sync        â”‚
   â”‚ â€¢ Server validates                   â”‚
   â”‚ â€¢ Server creates MongoDB record      â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Success
          â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ SYNCED                               â”‚
   â”‚ â€¢ markTransactionSynced(id)          â”‚
   â”‚ â€¢ synced: true in IndexedDB          â”‚
   â”‚ â€¢ In MongoDB transactions collection â”‚
   â”‚ â€¢ Can still reference locally        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Organization

```
src/
â”‚
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ indexedDB.js âœ¨ NEW
â”‚       â”‚
â”‚       â””â”€â”€ Stores:
â”‚           â”œâ”€ PRODUCTS (with category index)
â”‚           â”œâ”€ CATEGORIES
â”‚           â”œâ”€ TRANSACTIONS (with synced/createdAt indexes)
â”‚           â””â”€ SYNC_META
â”‚
â”œâ”€â”€ services/
â”‚   â””â”€â”€ syncService.js âœ¨ NEW
â”‚       â”‚
â”‚       â””â”€â”€ Handles:
â”‚           â”œâ”€ Online/offline detection
â”‚           â”œâ”€ Auto-sync orchestration
â”‚           â””â”€ Batch transaction syncing
â”‚
â”œâ”€â”€ pages/api/
â”‚   â”œâ”€â”€ categories/ (EXISTING)
â”‚   â”œâ”€â”€ products/ (EXISTING)
â”‚   â””â”€â”€ transactions/
â”‚       â””â”€â”€ sync.js âœ¨ NEW
â”‚           â”‚
â”‚           â””â”€â”€ Endpoint:
â”‚               â”œâ”€ Receives offline transactions
â”‚               â”œâ”€ Validates data
â”‚               â””â”€ Saves to MongoDB
â”‚
â”œâ”€â”€ context/
â”‚   â””â”€â”€ CartContext.js ğŸ”„ MODIFIED
â”‚       â”‚
â”‚       â””â”€â”€ Changes:
â”‚           â”œâ”€ Import IndexedDB & syncService
â”‚           â”œâ”€ Save transactions to IndexedDB
â”‚           â”œâ”€ Track pendingSyncCount
â”‚           â””â”€ Export manualSync
â”‚
â””â”€â”€ components/
    â””â”€â”€ pos/
        â”œâ”€â”€ MenuScreen.js ğŸ”„ MODIFIED
        â”‚   â””â”€ Load from IndexedDB + manual sync
        â”œâ”€â”€ TopBar.js ğŸ”„ MODIFIED
        â”‚   â””â”€ Online/offline indicators
        â””â”€â”€ Sidebar.js ğŸ”„ MODIFIED
            â””â”€ Transaction sync button
```

---

All diagrams are now complete! These show the complete offline-first architecture from multiple perspectives.
